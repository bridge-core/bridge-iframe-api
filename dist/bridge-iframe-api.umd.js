(function(n,s){typeof exports=="object"&&typeof module!="undefined"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(n=typeof globalThis!="undefined"?globalThis:n||self,s(n.BridgeIframeAPI={}))})(this,function(n){"use strict";class s{constructor(e=window.top){if(!e)throw new Error("You must provide a valid target in order to create a channel");this.target=e}get port(){if(!this._port)throw new Error("You must open the channel/connect to a channel before triggering events");return this._port}open(){const e=new MessageChannel;this._port=e.port1,this.target.postMessage("open-channel","*",[e.port2])}connect(){return new Promise(e=>{const r=t=>{t.data!=="open-channel"||t.ports.length===0||(this._port=t.ports[0],globalThis.removeEventListener("message",r),e())};globalThis.addEventListener("message",r)})}trigger(e,r,t){const a=this.simpleTrigger(e,r);return new Promise((p,d)=>{const o=u=>{const{type:h,uuid:l,channelId:f,error:g,payload:c}=u.data;if(!(h!=="response"||l!==a)){if(g){d(g);return}i&&clearTimeout(i),this.port.removeEventListener("message",o),p(c)}},i=t?setTimeout(()=>{this.port.removeEventListener("message",o)},t):null;this.port.addEventListener("message",o)})}simpleTrigger(e,r){const t=crypto.randomUUID();return this.port.postMessage({type:e,uuid:t,origin:window.origin,payload:r}),t}on(e,r){if(e==="response")throw new Error("The response event type is reserved for internal use.");const t=a=>{const{type:p,origin:d,uuid:o,payload:i}=a.data;p===e&&r(i,d,this.createResponseFunction(o))};return this.port.addEventListener("message",t),{dispose:()=>{this.port.removeEventListener("message",t)}}}createResponseFunction(e){return r=>{this.port.postMessage({type:"response",uuid:e,origin:window.origin,payload:r})}}}n.Channel=s,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
